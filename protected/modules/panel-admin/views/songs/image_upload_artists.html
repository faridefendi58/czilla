{% extends "layout.html" %}
{% block pagetitle %}
Upload Artist - {{ App.params.site_name }}
{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ 'css/bootstrap-fileupload.min.css' | admin_asset_url }}" />
<link rel="stylesheet" type="text/css" href="{{ 'lib/croppie/croppie.css' | admin_asset_url }}">
<div id="main_wrapper">
    <div class="page_bar clearfix">
        <div class="row">
            <div class="col-sm-10">
                <h1 class="page_title">Upload Artist</h1>
            </div>
            <div class="col-sm-2 text-right">
                <a class="btn btn-default" href="{{ 'song/images/artists' | link }}">Daftar Artist</a>
            </div>
        </div>
    </div>
    <div class="page_content">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            Upload Artist
                        </div>
                        <div class="panel-body">
                            <form method="post" id="artist-form"
                                  action="{{ 'song/images/upload-artist' | link }}"
                                  enctype="multipart/form-data">

                                <div class="alert alert-success" style="display: none;"></div>
                                <div class="alert alert-warning" style="display: none;"></div>

                                <div class="form-group col-md-6">
                                    <label class="control-label">Artist Name <span class="red">*</span></label>
                                    <input type="text" name="Artists[title]" class="form-control required" id="artist-name" {% if App.request.params.artist_name %}value="{{ App.request.params.artist_name }}"{% endif %}>
                                </div>

                                <div class="form-group col-md-12" id="img-standard-field">
                                    <label class="control-label">Image <span class="red">*</span></label>
                                    <div class="fileupload fileupload-new" data-provides="fileupload">
                                        <div class="input-append">
                                            <div class="uneditable-input">
                                                <i class="glyphicon glyphicon-file fileupload-exists"></i>
                                                <span class="fileupload-preview"></span>
                                            </div>
                                            <span class="btn btn-default btn-file">
                                                <span class="fileupload-new">Select file</span>
                                                <span class="fileupload-exists">Change</span>
                                                <input type="file" name="Artists[image]" class="reviewer-image"/>
                                            </span>
                                            <a href="#" class="btn btn-default fileupload-exists" data-dismiss="fileupload">Remove</a>
                                        </div>
                                    </div>
                                    <div class="clearfix mb15"></div>
                                </div>

                                <div class="form-group col-md-12" id="img-crop-field" style="display: none;">
                                    <label class="col-sm-2 control-label">Image</label>
                                    <div class="col-sm-10">
                                        <input type=file name="Artists[photo]" class="img-upload-input" editor="#img-upload-panel" target="#image" status="#status"
                                               passurl="{{ 'song/images/upload-artist' | link }}" pshape="square" w=200 h=200 size="{150,150}" accept=".jpg,.jpeg,.png" temp="#image-temp" dest_file_name="" required/>
                                        <img src="" alt="" id="image" style="max-width:300px;"/>
                                        <input id="image-temp" type="hidden" name="Artists[photo_temp]" value="">
                                        <div id="status"></div>
                                        <div class="" id="img-upload-panel" style="display: none;">
                                            <div class="row">
                                                <div class="col-md-6 col-sm-6 col-xs-12">
                                                    <div class="img-edit-container"></div>
                                                </div>
                                                <div class="col-md-6 col-sm-6 col-xs-12">
                                                    <div class="row">
                                                        <div class="col-md-12 col-sm-12 col-xs-12">
                                                            <p>Brightness</p>
                                                            <input type="range" class="form-control-range filter" min=0 max=200 value=100 step=1 filter="brightness"/>
                                                        </div>
                                                        <div class="col-md-12 col-sm-12 col-xs-12">
                                                            <p>Threshold</p>
                                                            <input type="range" class="form-control-range filter" min=0 max=200 value=100 step=1 filter="threshold"/>
                                                        </div>
                                                    </div>
                                                    <div class="row mt10">
                                                        <div class="col-sm-3 col-xs-6">
                                                            <button type="button" class="btn btn-default filter" filter="grayscale">Grayscale</button>
                                                        </div>
                                                        <div class="col-sm-3 col-xs-6">
                                                            <button type="button" class="btn btn-dark filter" filter="sharpen">Sharpen</button>
                                                        </div>
                                                        <div class="col-sm-3 col-xs-6">
                                                            <button type="button" class="btn btn-dark filter" filter="blur">Blur</button>
                                                        </div>
                                                        <div class="col-sm-3 col-xs-6">
                                                            <button type="button" class="btn btn-dark img-clear-filter">Clear</button>
                                                        </div>
                                                    </div>
                                                    <div class="row mt10">
                                                        <div class="col-sm-4 col-xs-6">
                                                            <button type="button" class="btn btn-dark img-rotate-left">Rotate Left</button>
                                                        </div>
                                                        <div class="col-sm-4 col-xs-6">
                                                            <button type="button" class="btn btn-dark img-rotate-right">Rotate Right</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="row mt10">
                                                <div class="col-sm-2 col-xs-6">
                                                    <button type="button" class="btn btn-warning img-remove-btn">Clear</button>
                                                </div>
                                                <div class="col-sm-3 col-xs-6">
                                                    <button type="button" class="btn btn-success img-upload-btn">Upload Foto Sekarang</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group col-md-12">
                                    <input type="submit" name="Submit" value="Simpan" class="btn btn-success btn-submit" onclick="return saveArtist(this);">
                                    <a href="javascript:void(0);" onclick="needCropImage(this);" id="crop-img-btn">Crop Image Instead</a>
                                    <a href="javascript:void(0);" onclick="standardUpload(this);" id="standard-img-btn" style="display: none;">Use Standard Image Upload</a>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% include 'partial/right_menu.html' %}
{% endblock %}
{% block endbodyjs %}
<script src="{{ 'js/bootstrap-fileupload.min.js' | admin_asset_url }}"></script>
<script src="{{ 'lib/croppie/jquery-3.4.1.min.js' | admin_asset_url }}"></script>
<script src="{{ 'lib/croppie/popper.min.js' | admin_asset_url }}"></script>
<script src="{{ 'lib/croppie/croppie.min.js' | admin_asset_url }}"></script>
<script src="{{ 'lib/croppie/imguploader.js' | admin_asset_url }}"></script>
<script type="text/javascript">
    function saveArtist(dt) {
        var validate = jb_validation.validate($('form[id="artist-form"]'));
        if (!validate) {
            return false;
        }

        var formData = new FormData($('form[id="artist-form"]')[0]);
        var url = $(dt).parent().parent().attr('action');

        $.ajax({
            'url': url,
            'type':'post',
            'data': formData,
            'dataType': 'json',
            'async': false,
            'success': function(data) {
                console.log(data);
                var alert_success = $('#artist-form').find('.alert-success');
                var alert_warning = $('#artist-form').find('.alert-warning');
                if (data.status == 'success') {
                    alert_success.html(data.message);
                    alert_success.show();
                    alert_warning.hide();
                    $('form[id="artist-form"]').find('.form-group').hide();
                    setTimeout(function () {
                        window.location.reload(true);
                    }, 5000);
                } else {
                    alert_warning.html(data.message);
                    alert_warning.show();
                    alert_success.hide();
                }
            },
            'errors': function (request, status, error) {
                console.log(request.responseText);
            },
            'cache': false,
            'contentType': false,
            'processData': false
        });

        return false;
    }
    function needCropImage(dt) {
        var artist_name = $('#artist-name').val();
        if (artist_name.length > 0) {
            $('.img-upload-input').attr('dest_file_name', artist_name);
            $('input[type="submit"]').hide();
            $('#img-standard-field').hide();
            $('#img-crop-field').show();
            $('#standard-img-btn').show();
            $(dt).hide();
        } else {
            alert('Please insert the artist name first!');
        }
    }
    function standardUpload(dt) {
        $('input[type="submit"]').show();
        $('#img-standard-field').show();
        $('#img-crop-field').hide();
        $('#crop-img-btn').show();
        $(dt).hide();
    }
</script>
{% endblock %}
